{% extends 'base.html' %}
{% load static %}

{% block title %}Моя аренда — SelfStorage{% endblock %}

{% block content %}
<div class="row mt-header">
    <div class="col-lg-3 d-flex flex-column nav nav-pills">
        <!-- ИЗМЕНЕНО: убран namespace users: -->
        <a href="{% url 'cabinet' %}" 
           class="ps-0 btn bg-white fs_24 shadow-none SelfStorage_grey SelfStorage_tab">
            Личный кабинет
        </a>
        <a href="{% url 'my_rent' %}" 
           class="ps-0 btn bg-white fs_24 shadow-none SelfStorage_orange SelfStorage_tab active">
            Моя аренда
        </a>
        <a href="{% url 'faq' %}" 
           class="btn fs_24 shadow-none text-decoration-none SelfStorage_grey SelfStorage_tab">
            FAQ
        </a>
        <a href="{% url 'logout' %}" 
           class="btn fs_24 shadow-none text-decoration-none SelfStorage_grey SelfStorage_tab">
            Выйти
        </a>
    </div>
    
    <div class="col-lg-9">
        <div class="card p-5">
            <h1 class="fw-bold SelfStorage_green mb-5">
                Добрый день, {{ user.first_name|default:user.username }}!
            </h1>
            
            <!-- УДАЛЕНО: Кнопка "История аренды" -->
            
            {% for rental in rentals %}
            <div class="mb-5 pb-4 border-bottom">
                <h4 class="SelfStorage_green">Мой склад №{{ forloop.counter }}</h4>
                <h4>{{ rental.warehouse }}</h4>
                
                <h4 class="SelfStorage_green mt-3">Мой бокс</h4>
                <h4>
                    {% for box in rental.boxes.all %}
                        №{{ box.number }}{% if not forloop.last %}, {% endif %}
                    {% empty %}
                        Ожидает назначения
                    {% endfor %}
                </h4>
                
                <!-- ДОБАВЛЕНО: Размер бокса -->
                <h4 class="SelfStorage_green mt-3">Размер бокса</h4>
                <h4>
                    {% for box in rental.boxes.all %}
                        {% if box.box_type %}
                            {{ box.box_type.length }}×{{ box.box_type.width }}×{{ box.box_type.height }} м 
                            ({{ box.box_type.volume }} м³)
                        {% else %}
                            Не указан
                        {% endif %}
                        {% if not forloop.last %}<br>{% endif %}
                    {% empty %}
                        —
                    {% endfor %}
                </h4>
                
                <h4 class="SelfStorage_green mt-3">Срок аренды</h4>
                <h4>{{ rental.start_date|date:"d.m.Y" }} — {{ rental.end_date|date:"d.m.Y"|default:"Не ограничен" }}</h4>
                
                <div class="mt-3">
                    <button class="btn fs_24 px-5 py-3 text-white border-8 SelfStorage__bg_green SelfStorage__btn2_green mb-3">
                        <!-- ИЗМЕНЕНО: убран namespace storage: -->
                        <a href="{% url 'extend_rent' rental.id %}" 
                            class="btn fs_24 px-5 py-3 text-white border-8 SelfStorage__bg_green SelfStorage__btn2_green mb-3">
                            Продлить аренду
                        </a>
                    </button>
                </div>
                <div>
                    <button class="btn fs_24 px-5 py-3 text-white border-8 SelfStorage__bg_orange SelfStorage__btn2_orange mb-3">
                        <!-- ИЗМЕНЕНО: убран namespace storage: -->
                    <a href="{% url 'open_box' rental.id %}" 
                        class="btn fs_24 px-5 py-3 text-white border-8 SelfStorage__bg_orange SelfStorage__btn2_orange mb-3">
                        Открыть бокс
                    </a>
                    </button>
                </div>
                <!-- ИЗМЕНЕНО: ссылка на FAQ -->
                <a href="{% url 'faq' %}" class="SelfStorage_orange">Нужна помощь?</a>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}