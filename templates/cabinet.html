{% extends 'base.html' %}
{% load static %}

{% block title %}Личный кабинет — {{ user.get_full_name|default:user.username }}{% endblock %}

{% block content %}
<div class="container">
    <div class="row mt-header">
        <div class="col-lg-3 d-flex flex-column nav nav-pills">
            <a href="{% url 'cabinet' %}" 
            class="ps-0 btn bg-white fs_24 shadow-none SelfStorage_orange SelfStorage_tab active">
                Личный кабинет
            </a>
            <a href="{% url 'my_rent' %}"
            class="ps-0 btn bg-white fs_24 shadow-none SelfStorage_grey SelfStorage_tab">
                Моя аренда
            </a>
            <a href="{% url 'faq' %}" 
            class="btn fs_24 shadow-none text-decoration-none SelfStorage_grey SelfStorage_tab">
                FAQ
            </a>
            <a href="{% url 'logout' %}" 
            class="btn fs_24 shadow-none text-decoration-none SelfStorage_grey SelfStorage_tab">
                Выйти
            </a>
        </div>
        
        <div class="col-lg-9">
            <div class="card p-5">
                <div class="row">
                    <div class="col-12 col-sm-5 d-flex flex-column align-items-center">
                        <img src="{{ profile.avatar_url }}" 
                            class="rounded-pill mb-3" 
                            alt="{{ user.get_full_name|default:user.username }}" 
                            width="150" 
                            height="150">
                        <h4>{{ user.get_full_name|default:user.username }}</h4>
                        
                        <a href="{% url 'edit_profile' %}" class="btn SelfStorage_orange mt-3">
                            Редактировать профиль
                        </a>
                        
                        <div class="mt-4 text-center">
                            <h5 class="SelfStorage_green mb-2">Ваш QR-код для доступа</h5>
                            {% if profile.qr_code %}
                                <img src="{{ profile.qr_code.url }}" 
                                    alt="QR-код доступа к боксу" 
                                    class="img-fluid" 
                                    style="max-width: 200px; max-height: 200px;">
                            {% else %}
                                <div class="alert alert-warning">QR-код не сгенерирован</div>
                            {% endif %}
                            <p class="text-muted small mt-2">
                                Покажите этот код на складе для доступа к вашему боксу
                            </p>
                        </div>
                    </div>
                    
                    <div class="col-12 col-sm-7 d-flex flex-column">
                        <div class="mb-4">
                            <label class="fs_24 SelfStorage_green">Имя</label>
                            <div class="fs_24">{{ user.first_name|default:'Не указано' }}</div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="fs_24 SelfStorage_green">Фамилия</label>
                            <div class="fs_24">{{ user.last_name|default:'Не указана' }}</div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="fs_24 SelfStorage_green">Электронная почта</label>
                            <div class="fs_24">{{ user.email }}</div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="fs_24 SelfStorage_green">Телефон</label>
                            <div class="fs_24">{{ profile.phone|default:'Не указан' }}</div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="fs_24 SelfStorage_green">Адрес доставки</label>
                            <div class="fs_24">{{ profile.address|default:'Не указан' }}</div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="fs_24 SelfStorage_green">Дата регистрации</label>
                            <div class="fs_24">{{ user.date_joined|date:"d.m.Y" }}</div>
                        </div>
                        
                        <div class="alert alert-info mt-4 p-3">
                            <strong>Как использовать QR-код:</strong><br>
                            • Для сдачи вещей на хранение — покажите код при приёме вещей на складе<br>
                            • Для забора вещей — отсканируйте код на терминале у входа в складское помещение
                        </div>

                        <div class="mt-4 p-4" style="background: #f0f8ff; border-radius: 10px; border: 2px solid #0088cc;">
                            <h5 class="mb-3">Получайте уведомления в Telegram!</h5>
                            <p class="mb-3">Чтобы получать напоминания об окончании аренды и другие уведомления:</p>
                            <ol class="mb-3">
                                <li>Откройте бота: <a href="https://t.me/Self_Storage_message_bot" target="_blank" class="fw-bold">@Self_Storage_message_bot</a></li>
                                <li>Нажмите <strong>/start</strong></li>
                                <li>Введите ваш <strong>email</strong> или <strong>телефон</strong> из профиля</li>
                                <li>Готово! Теперь вы будете получать:</li>
                            </ol>
                            <ul class="mb-3">
                                <li>Уведомление о заказе</li>
                                <li>Напоминания за 30, 14, 7 и 3 дня до окончания аренды</li>
                                <li>Уведомления о просрочке</li>
                                <li>QR-код для доступа к боксу</li>
                            </ul>
                            {% if profile.telegram_linked %}
                                <div class="alert alert-success mb-0">
                                    <strong>Telegram привязан!</strong> Ваш chat_id: {{ profile.telegram_chat_id }}
                                </div>
                            {% else %}
                                <div class="alert alert-warning mb-0">
                                    <strong>Telegram не привязан</strong> — выполните шаги выше
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}